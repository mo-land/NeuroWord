<% breadcrumb :mypage %>
<h1 class="text-2xl font-bold text-left p-6"><%= t('.title') %></h1>
<div class="flex flex-col lg:flex-row gap-4 px-4">
  <div class="w-full lg:w-auto">
    <div class="max-w-3xl mx-auto">
      <%= turbo_frame_tag current_user do %>
        <%= render "profile" %>
      <% end %>
    </div>
  </div>

  <div class="w-full lg:w-auto lg:flex-1 lg:pl-6" style="max-width: 100%; overflow-x: auto;">
    <%= calendar_chart(
      {
        data: @calendar_data
      },
      class: '',
      style: 'height: 130px; width: 300px;',
      options: {
        grid: {
          top: 10,
          bottom: 10,
          left: 80,
          right: 40
        },
        visualMap: {
          show: false,
          min: 0,
          max: 40,
          inRange: {
            color: ['#DAFADA', '#008000']
          }
        },
        calendar: [
          {
            range: ["#{1.month.ago.beginning_of_month.strftime('%Y-%m-%d')}", "#{Date.today.strftime('%Y-%m-%d')}"],
            top: 20,
            left: 50,
            right: 50,
            cellSize: [13],
            yearLabel: { show: true },
            monthLabel: {
              margin: 1,
              show: true,
              formatter: '{M}月'
            },
            dayLabel: {
              margin: 2,
              firstDay: 1,
              nameMap: ['日', '月', '火', '水', '木', '金', '土']
            },
            splitLine: {
              lineStyle: {
                color: '#793205',
                width: 0.5
              }
            }
          }
        ]
      })
    %>
  </div>
</div>



<!-- name of each tab group should be unique -->
<div class="tabs tabs-lift mt-3 p-4">
  <%= link_to mypage_path(tab: 'user_questions'),
              class: "tab #{'tab-active' if @current_tab == 'user_questions'}",
              role: 'tab',
              aria: { label: t('.user_questions') } do %>
    <%= t('.user_questions') %>
  <% end %>
  <div class="tab-content bg-base-100 border-base-300 p-6 <%= 'hidden' unless @current_tab == 'user_questions' %>">
    <%= render 'user_questions' %>
  </div>

  <%= link_to mypage_path(tab: 'user_lists', list_id: @list.id),
              class: "tab #{'tab-active' if @current_tab == 'user_lists'}",
              role: 'tab',
              aria: { label: t('.user_lists') } do %>
    <%= t('.user_lists') %>
  <% end %>
  <div class="tab-content bg-base-100 border-base-300 p-6 <%= 'hidden' unless @current_tab == 'user_lists' %>" data-controller="list-selector">
    <div class="flex">
      <div id="list_selector_container" class="mb-2">
        <%= render "list_selector", lists: @lists, selected_list_id: @list.id %>
      </div>

      <div class="dropdown dropdown-end">
        <div tabindex="0" role="button" class="btn btn-ghost"><i class="fa-solid fa-ellipsis-vertical"></i></div>
        <ul tabindex="-1" class="dropdown-content menu bg-gradient-to-br from-base-100 to-base-200 rounded-box z-1 w-52 p-2 shadow-sm">
          <div class="<%= 'hidden' if @list.is_favorite %>" >

            <li>
              <%= link_to edit_list_path(@list), data: { turbo_frame: "modal" } do %>
                <i class="fa-solid fa-pen text-success/70" aria-hidden="true"></i>
                リスト名を変更
              <% end %>
            </li>

            <li>
              <%= link_to @list, class: "text-warning", data: {turbo_method: :delete, turbo_confirm: t('defaults.delete_confirm') } do %>
                 <i class="fa-solid fa-trash text-warning/70" aria-hidden="true"></i>
                  このリストを削除
              <% end %>
            </li>
          </div>

          <li>
            <%= link_to new_list_path(list_id: @list.id), data: { turbo_frame: "modal" } do %>
              <i class="fa-solid fa-plus text-error" aria-hidden="true"></i>
              新規リストを作成
            <% end %>
          </li>

        </ul>
      </div>
    </div>

    <%= render 'shared/filter_out_understood_questions' %>

    <% if @list_questions.present? %>
      <%= link_to batch_play_list_path(@list), class: "btn btn-secondary mt-2 mb-4" do %>
        <i class="fa-solid fa-play"></i>
        このリストをまとめてプレイ
      <% end %>
    <% end %>

    <%= turbo_frame_tag "list_questions" do %>
      <%= render partial: "users/list_questions", locals: { list_questions: @list_questions, list_id: @list.id } %>
    <% end %>
  </div>

  <%= link_to mypage_path(tab: 'game_records'),
              class: "tab #{'tab-active' if @current_tab == 'game_records'}",
              role: 'tab',
              aria: { label: t('.game_records') } do %>
    <%= t('.game_records') %>
  <% end %>
  <div class="tab-content bg-base-100 border-base-300 p-6 <%= 'hidden' unless @current_tab == 'game_records' %>">

        <div class="mb-2">
          <%= render 'shared/filter_out_understood_questions' %>
        </div>
        <!--%= render 'game_records/game_records' %-->
        <% if @game_records.present? %>
          <%= paginate @game_records, param_name: :game_records_page, params: { tab: 'game_records' } %>
            <%= render 'game_records/game_record' %>
          <div class="p-6">
            <%= paginate @game_records, param_name: :game_records_page, params: { tab: 'game_records' } %>
          </div>
        <% else %>
          <div class="m-8">履歴がありません</div>
        <% end %>

  </div>
</div>

<%= turbo_frame_tag "modal" %>

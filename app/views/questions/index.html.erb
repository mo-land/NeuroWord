<% content_for :hide_breadcrumbs, true %>
<% content_for :flash_wrapper_class, "lg:ml-72" %>
<%# 基本パンくず %>
<% breadcrumb :questions_index %>
<%# カテゴリ表示 %>
<% parent_crumb = :questions_index %>
<% if @selected_category.present? %>
  <% breadcrumb :category_filter_simple, @selected_category %>
  <% parent_crumb = [:category_filter_simple, @selected_category] %>
<% end %>
<%# タグ・検索の複合絞り込み表示 %>
<%
  search_filters = []
  search_filters << "タグ【#{@selected_tag.name}】" if @selected_tag.present?
  search_filters << "キーワード【#{params[:search_keyword]}】" if params[:search_keyword].present?

  if search_filters.any?
    filter_text = search_filters.join(' × ')
    breadcrumb :search_filters_applied, filter_text, @search_questions.total_count, parent_crumb
  end
%>
<div class="drawer lg:drawer-open">
  <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />
  <div class="drawer-content flex flex-col lg:ml-72">
    <!-- Page content here -->
    <div class="px-4 lg:px-6 py-2 flex items-center">
      <%= breadcrumbs separator: " &rsaquo; " %>
      <% if params[:tag_name].present? || params[:search_keyword].present? %>
        <%= link_to questions_path(category_id: @selected_category.id), class: "btn btn-circle btn-sm" do %>
          <i class="fa-solid fa-x"></i>
        <% end %>
      <% end %>
    </div>
    <div class="flex gap-1 items-start">
      <label for="my-drawer-3" class="btn drawer-button lg:hidden self-start ml-3 mb-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linejoin="round" stroke-linecap="round" stroke-width="2" fill="none" stroke="currentColor" class="inline-block size-4 my-1.5"><path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path><path d="M9 4v16"></path><path d="M14 10l2 2l-2 2"></path></svg>
        カテゴリ一覧
      </label>
      <%= render 'search_form' %>
    </div>
        <div class="px-3">
          <%= render 'shared/filter_out_understood_questions' %>
        </div>
        <%= paginate @search_questions %>
        <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-12 mx-auto max-w-screen-6xl py-8 items-stretch">
        <!-- 問題一覧 -->
          <% if @search_questions.present? %>
            <%= render @search_questions %>
          <% else %>
            <div class="m-8">問題がありません</div>
          <% end %>
        </div>
      <div class="p-2">
        <%= paginate @search_questions %>
      </div>

  </div>
  <div class="drawer-side">
    <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>
    <ul class="menu bg-base-200 min-h-full w-72 px-4 py-20 lg:fixed lg:top-0 lg:left-0 lg:h-screen lg:overflow-y-auto flex-nowrap">
      <!-- Sidebar content here -->
      <li><%= link_to "全て (#{@total_count})", questions_path(tag_name: params[:tag_name], search_keyword: params[:search_keyword]), class: "link link-hover #{params[:category_id].blank? ? 'font-bold text-error' : ''}" %></li>
      <% @categories.each do |parent| %>
        <div class="category">
          <li><%= link_to "#{parent.name} (#{@category_counts[parent.id]})", questions_path(category_id: parent.id, tag_name: params[:tag_name], search_keyword: params[:search_keyword]), class: "link link-hover #{@selected_category == parent ? 'font-bold text-error' : ''}" %></li>

          <% parent.children.each do |child| %>
            <div class="ml-2">
              <h3>└ <%= link_to "#{child.name} (#{@category_counts[child.id]})", questions_path(category_id: child.id, tag_name: params[:tag_name], search_keyword: params[:search_keyword]), class: "link link-hover #{@selected_category == child ? 'font-bold text-error' : ''}" %></h3>

              <% child.children.each do |grandchild| %>
                <div class="ml-4 text-gray-600">
                  ・<%= link_to "#{grandchild.name} (#{@category_counts[grandchild.id]})", questions_path(category_id: grandchild.id, tag_name: params[:tag_name], search_keyword: params[:search_keyword]), class: "link link-hover #{@selected_category == grandchild ? 'font-bold text-error' : ''}" %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </ul>
  </div>
</div>